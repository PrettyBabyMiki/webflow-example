/*
	Copyright (c) 2004-2007, The Dojo Foundation
	All Rights Reserved.

	Licensed under the Academic Free License version 2.1 or above OR the
	modified BSD license. For more information on Dojo licensing, see:

		http://dojotoolkit.org/book/dojo-book-0-9/introduction/licensing
*/


if(!dojo._hasResource["dijit.form.InlineEditBox"]){dojo._hasResource["dijit.form.InlineEditBox"]=true;dojo.provide("dijit.form.InlineEditBox");dojo.require("dojo.i18n");dojo.require("dijit.form._FormWidget");dojo.require("dijit._Container");dojo.require("dijit.form.Button");dojo.requireLocalization("dijit","common",null,"ROOT,cs,de,es,fr,hu,it,ja,ko,pl,pt,ru,zh,zh-tw");dojo.deprecated("dijit.form.InlineEditBox is deprecated, use dijit.InlineEditBox instead","","1.1");dojo.declare("dijit.form.InlineEditBox",[dijit.form._FormWidget,dijit._Container],{templateString:"<span\n\t><fieldset dojoAttachPoint=\"editNode\" style=\"display:none;\" waiRole=\"presentation\"\n\t\t><div dojoAttachPoint=\"containerNode\" dojoAttachEvent=\"onkeypress:_onEditWidgetKeyPress\"></div\n\t\t><div dojoAttachPoint=\"buttonContainer\"\n\t\t\t><button class='saveButton' dojoAttachPoint=\"saveButton\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:save\">${buttonSave}</button\n\t\t\t><button class='cancelButton' dojoAttachPoint=\"cancelButton\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:cancel\">${buttonCancel}</button\n\t\t></div\n\t></fieldset\n\t><span tabIndex=\"0\" dojoAttachPoint=\"textNode,focusNode\" waiRole=\"button\" style=\"display:none;\"\n\t\tdojoAttachEvent=\"onkeypress:_onKeyPress,onclick:_onClick,onmouseout:_onMouseOut,onmouseover:_onMouseOver,onfocus:_onMouseOver,onblur:_onMouseOut\"\n\t></span\n></span>\n",editing:false,autoSave:true,buttonSave:"",buttonCancel:"",renderAsHtml:false,widgetsInTemplate:true,_display:"",startup:function(){if(!this._started){if(this.editWidget){this.containerNode.appendChild(this.editWidget.domNode);}else{this.editWidget=this.getChildren()[0];}var _1=dojo.getComputedStyle(this.domNode);dojo.forEach(["fontWeight","fontFamily","fontSize","fontStyle"],function(_2){this.editWidget.focusNode.style[_2]=_1[_2];},this);this._setEditValue=dojo.hitch(this.editWidget,this.editWidget.setDisplayedValue||this.editWidget.setValue);this._getEditValue=dojo.hitch(this.editWidget,this.editWidget.getDisplayedValue||this.editWidget.getValue);this._setEditFocus=dojo.hitch(this.editWidget,this.editWidget.focus);this._isEditValid=dojo.hitch(this.editWidget,this.editWidget.isValid||function(){return true;});this.editWidget.onChange=dojo.hitch(this,"_onChange");if(!this.autoSave){this._oldSetValue=this.editWidget.setValue;var _3=this;this.editWidget.setValue=dojo.hitch(this,function(_4){_3._oldSetValue.apply(_3.editWidget,arguments);_3._onEditWidgetKeyPress(null);});}this._showText();this._started=true;}},postMixInProperties:function(){this._srcTag=this.srcNodeRef.tagName;this._srcStyle=dojo.getComputedStyle(this.srcNodeRef);var _5=this.srcNodeRef.style;this._display="";if(_5&&_5.display){this._display=_5.display;}else{switch(this.srcNodeRef.tagName.toLowerCase()){case "span":case "input":case "img":case "button":this._display="inline";break;default:this._display="block";break;}}this.inherited("postMixInProperties",arguments);this.messages=dojo.i18n.getLocalization("dijit","common",this.lang);dojo.forEach(["buttonSave","buttonCancel"],function(_6){if(!this[_6]){this[_6]=this.messages[_6];}},this);},postCreate:function(){if(this.autoSave){dojo.style(this.buttonContainer,"display","none");}},_onKeyPress:function(e){if(this.disabled||e.altKey||e.ctrlKey){return;}if(e.charCode==dojo.keys.SPACE||e.keyCode==dojo.keys.ENTER){dojo.stopEvent(e);this._onClick(e);}},_onMouseOver:function(){if(!this.editing){var _8=this.disabled?"dijitDisabledClickableRegion":"dijitClickableRegion";dojo.addClass(this.textNode,_8);}},_onMouseOut:function(){if(!this.editing){var _9=this.disabled?"dijitDisabledClickableRegion":"dijitClickableRegion";dojo.removeClass(this.textNode,_9);}},_onClick:function(e){if(this.editing||this.disabled){return;}this._onMouseOut();this.editing=true;this._setEditValue(this._isEmpty?"":(this.renderAsHtml?this.textNode.innerHTML:this.textNode.innerHTML.replace(/\s*\r?\n\s*/g,"").replace(/<br\/?>/gi,"\n").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")));this._initialText=this._getEditValue();this._visualize();setTimeout(dojo.hitch(this,function(){this._setEditFocus();this.saveButton.setDisabled(true);}),1);},_visualize:function(){dojo.style(this.editNode,"display",this.editing?this._display:"none");if(this.editing){this._setEditFocus();}dojo.style(this.textNode,"display",this.editing?"none":this._display);},_showText:function(){var _b=""+this._getEditValue();dijit.form.InlineEditBox.superclass.setValue.call(this,_b);if(/^\s*$/.test(_b)){_b="?";this._isEmpty=true;}else{this._isEmpty=false;}if(this.renderAsHtml){this.textNode.innerHTML=_b;}else{this.textNode.innerHTML="";if(_b.split){var _c=this;var _d=true;dojo.forEach(_b.split("\n"),function(_e){if(_d){_d=false;}else{_c.textNode.appendChild(document.createElement("BR"));}_c.textNode.appendChild(document.createTextNode(_e));});}else{this.textNode.appendChild(document.createTextNode(_b));}}this._visualize();},save:function(e){if(typeof e=="object"){dojo.stopEvent(e);}if(!this.enableSave()){return;}this.editing=false;this._showText();if(e){dijit.focus(this.focusNode);}if(this._lastValue!=this._lastValueReported){this.onChange(this._lastValue);}},cancel:function(e){if(e){dojo.stopEvent(e);}this.editing=false;this._visualize();if(e){dijit.focus(this.focusNode);}},setValue:function(_11){this._setEditValue(_11);this.editing=false;this._showText();},_onEditWidgetKeyPress:function(e){if(!this.editing){return;}if(this.autoSave){if(e.keyCode==dojo.keys.ESCAPE){this.cancel(e);}else{if(e.keyCode==dojo.keys.ENTER){this.save(e);}}}else{var _13=this;setTimeout(function(){_13.saveButton.setDisabled(_13._getEditValue()==_13._initialText);},100);}},_onBlur:function(){if(this.autoSave&&this.editing){if(this._getEditValue()==this._initialText){this.cancel();}else{this.save();}}},enableSave:function(){return this._isEditValid();},_onChange:function(){if(!this.editing){this._showText();}else{if(this.autoSave){this.save(1);}else{this.saveButton.setDisabled((this._getEditValue()==this._initialText)||!this.enableSave());}}},setDisabled:function(_14){this.saveButton.setDisabled(_14);this.cancelButton.setDisabled(_14);this.textNode.disabled=_14;this.editWidget.setDisabled(_14);this.inherited("setDisabled",arguments);}});}
/*
	Copyright (c) 2004-2007, The Dojo Foundation
	All Rights Reserved.

	Licensed under the Academic Free License version 2.1 or above OR the
	modified BSD license. For more information on Dojo licensing, see:

		http://dojotoolkit.org/book/dojo-book-0-9/introduction/licensing
*/


if(!dojo._hasResource["dijit.layout.StackContainer"]){dojo._hasResource["dijit.layout.StackContainer"]=true;dojo.provide("dijit.layout.StackContainer");dojo.require("dijit._Templated");dojo.require("dijit.layout._LayoutWidget");dojo.require("dijit.form.Button");dojo.declare("dijit.layout.StackContainer",dijit.layout._LayoutWidget,{doLayout:true,_started:false,postCreate:function(){dijit.setWaiRole((this.containerNode||this.domNode),"tabpanel");this.connect(this.domNode,"onkeypress",this._onKeyPress);},startup:function(){if(this._started){return;}var _1=this.getChildren();dojo.forEach(_1,this._setupChild,this);dojo.some(_1,function(_2){if(_2.selected){this.selectedChildWidget=_2;}return _2.selected;},this);var _3=this.selectedChildWidget;if(!_3&&_1[0]){_3=this.selectedChildWidget=_1[0];_3.selected=true;}if(_3){this._showChild(_3);}dojo.publish(this.id+"-startup",[{children:_1,selected:_3}]);this.inherited("startup",arguments);this._started=true;},_setupChild:function(_4){_4.domNode.style.display="none";_4.domNode.style.position="relative";return _4;},addChild:function(_5,_6){dijit._Container.prototype.addChild.apply(this,arguments);_5=this._setupChild(_5);if(this._started){this.layout();dojo.publish(this.id+"-addChild",[_5,_6]);if(!this.selectedChildWidget){this.selectChild(_5);}}},removeChild:function(_7){dijit._Container.prototype.removeChild.apply(this,arguments);if(this._beingDestroyed){return;}if(this._started){dojo.publish(this.id+"-removeChild",[_7]);this.layout();}if(this.selectedChildWidget===_7){this.selectedChildWidget=undefined;if(this._started){var _8=this.getChildren();if(_8.length){this.selectChild(_8[0]);}}}},selectChild:function(_9){_9=dijit.byId(_9);if(this.selectedChildWidget!=_9){this._transition(_9,this.selectedChildWidget);this.selectedChildWidget=_9;dojo.publish(this.id+"-selectChild",[_9]);}},_transition:function(_a,_b){if(_b){this._hideChild(_b);}this._showChild(_a);if(this.doLayout&&_a.resize){_a.resize(this._containerContentBox||this._contentBox);}},_adjacent:function(_c){var _d=this.getChildren();var _e=dojo.indexOf(_d,this.selectedChildWidget);_e+=_c?1:_d.length-1;return _d[_e%_d.length];},forward:function(){this.selectChild(this._adjacent(true));},back:function(){this.selectChild(this._adjacent(false));},_onKeyPress:function(e){dojo.publish(this.id+"-containerKeyPress",[{e:e,page:this}]);},layout:function(){if(this.doLayout&&this.selectedChildWidget&&this.selectedChildWidget.resize){this.selectedChildWidget.resize(this._contentBox);}},_showChild:function(_10){var _11=this.getChildren();_10.isFirstChild=(_10==_11[0]);_10.isLastChild=(_10==_11[_11.length-1]);_10.selected=true;_10.domNode.style.display="";if(_10._loadCheck){_10._loadCheck();}if(_10.onShow){_10.onShow();}},_hideChild:function(_12){_12.selected=false;_12.domNode.style.display="none";if(_12.onHide){_12.onHide();}},closeChild:function(_13){var _14=_13.onClose(this,_13);if(_14){this.removeChild(_13);_13.destroy();}},destroy:function(){this._beingDestroyed=true;this.inherited("destroy",arguments);}});dojo.declare("dijit.layout.StackController",[dijit._Widget,dijit._Templated,dijit._Container],{templateString:"<span wairole='tablist' dojoAttachEvent='onkeypress' class='dijitStackController'></span>",containerId:"",buttonWidget:"dijit.layout._StackButton",postCreate:function(){dijit.setWaiRole(this.domNode,"tablist");this.pane2button={};this._subscriptions=[dojo.subscribe(this.containerId+"-startup",this,"onStartup"),dojo.subscribe(this.containerId+"-addChild",this,"onAddChild"),dojo.subscribe(this.containerId+"-removeChild",this,"onRemoveChild"),dojo.subscribe(this.containerId+"-selectChild",this,"onSelectChild"),dojo.subscribe(this.containerId+"-containerKeyPress",this,"onContainerKeyPress")];},onStartup:function(_15){dojo.forEach(_15.children,this.onAddChild,this);this.onSelectChild(_15.selected);},destroy:function(){dojo.forEach(this._subscriptions,dojo.unsubscribe);this.inherited("destroy",arguments);},onAddChild:function(_16,_17){var _18=document.createElement("span");this.domNode.appendChild(_18);var cls=dojo.getObject(this.buttonWidget);var _1a=new cls({label:_16.title,closeButton:_16.closable},_18);this.addChild(_1a,_17);this.pane2button[_16]=_1a;_16.controlButton=_1a;dojo.connect(_1a,"onClick",dojo.hitch(this,"onButtonClick",_16));dojo.connect(_1a,"onClickCloseButton",dojo.hitch(this,"onCloseButtonClick",_16));if(!this._currentChild){_1a.focusNode.setAttribute("tabIndex","0");this._currentChild=_16;}},onRemoveChild:function(_1b){if(this._currentChild===_1b){this._currentChild=null;}var _1c=this.pane2button[_1b];if(_1c){_1c.destroy();}this.pane2button[_1b]=null;},onSelectChild:function(_1d){if(!_1d){return;}if(this._currentChild){var _1e=this.pane2button[this._currentChild];_1e.setChecked(false);_1e.focusNode.setAttribute("tabIndex","-1");}var _1f=this.pane2button[_1d];_1f.setChecked(true);this._currentChild=_1d;_1f.focusNode.setAttribute("tabIndex","0");},onButtonClick:function(_20){var _21=dijit.byId(this.containerId);_21.selectChild(_20);},onCloseButtonClick:function(_22){var _23=dijit.byId(this.containerId);_23.closeChild(_22);var b=this.pane2button[this._currentChild];if(b){dijit.focus(b.focusNode||b.domNode);}},adjacent:function(_25){var _26=this.getChildren();var _27=dojo.indexOf(_26,this.pane2button[this._currentChild]);var _28=_25?1:_26.length-1;return _26[(_27+_28)%_26.length];},onkeypress:function(e){if(this.disabled||e.altKey){return;}var _2a=true;if(e.ctrlKey||!e._djpage){var k=dojo.keys;switch(e.keyCode){case k.LEFT_ARROW:case k.UP_ARROW:case k.PAGE_UP:_2a=false;case k.RIGHT_ARROW:case k.DOWN_ARROW:case k.PAGE_DOWN:this.adjacent(_2a).onClick();dojo.stopEvent(e);break;case k.DELETE:if(this._currentChild.closable){this.onCloseButtonClick(this._currentChild);}dojo.stopEvent(e);break;default:if(e.ctrlKey){if(e.keyCode==k.TAB){this.adjacent(!e.shiftKey).onClick();dojo.stopEvent(e);}else{if(e.keyChar=="w"){if(this._currentChild.closable){this.onCloseButtonClick(this._currentChild);}dojo.stopEvent(e);}}}}}},onContainerKeyPress:function(_2c){_2c.e._djpage=_2c.page;this.onkeypress(_2c.e);}});dojo.declare("dijit.layout._StackButton",dijit.form.ToggleButton,{tabIndex:"-1",postCreate:function(evt){dijit.setWaiRole((this.focusNode||this.domNode),"tab");this.inherited("postCreate",arguments);},onClick:function(evt){dijit.focus(this.focusNode);},onClickCloseButton:function(evt){evt.stopPropagation();}});dojo.extend(dijit._Widget,{title:"",selected:false,closable:false,onClose:function(){return true;}});}
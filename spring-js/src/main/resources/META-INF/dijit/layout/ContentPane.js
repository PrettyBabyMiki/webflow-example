/*
	Copyright (c) 2004-2007, The Dojo Foundation
	All Rights Reserved.

	Licensed under the Academic Free License version 2.1 or above OR the
	modified BSD license. For more information on Dojo licensing, see:

		http://dojotoolkit.org/book/dojo-book-0-9/introduction/licensing
*/


if(!dojo._hasResource["dijit.layout.ContentPane"]){dojo._hasResource["dijit.layout.ContentPane"]=true;dojo.provide("dijit.layout.ContentPane");dojo.require("dijit._Widget");dojo.require("dijit.layout._LayoutWidget");dojo.require("dojo.parser");dojo.require("dojo.string");dojo.requireLocalization("dijit","loading",null,"cs,de,es,fr,hu,it,ja,ko,ROOT,pl,pt,ru,zh,zh-tw");dojo.declare("dijit.layout.ContentPane",dijit._Widget,{href:"",extractContent:false,parseOnLoad:true,preventCache:false,preload:false,refreshOnShow:false,loadingMessage:"<span class='dijitContentPaneLoading'>${loadingState}</span>",errorMessage:"<span class='dijitContentPaneError'>${errorState}</span>",isLoaded:false,"class":"dijitContentPane",postCreate:function(){this.domNode.title="";if(this.preload){this._loadCheck();}var _1=dojo.i18n.getLocalization("dijit","loading",this.lang);this.loadingMessage=dojo.string.substitute(this.loadingMessage,_1);this.errorMessage=dojo.string.substitute(this.errorMessage,_1);dojo.addClass(this.domNode,this["class"]);},startup:function(){if(this._started){return;}this._checkIfSingleChild();if(this._singleChild){this._singleChild.startup();}this._loadCheck();this._started=true;},_checkIfSingleChild:function(){var _2=dojo.query(">",this.containerNode||this.domNode),_3=_2.filter("[widgetId]");if(_2.length==1&&_3.length==1){this.isContainer=true;this._singleChild=dijit.byNode(_3[0]);}else{delete this.isContainer;delete this._singleChild;}},refresh:function(){return this._prepareLoad(true);},setHref:function(_4){this.href=_4;return this._prepareLoad();},setContent:function(_5){if(!this._isDownloaded){this.href="";this._onUnloadHandler();}this._setContent(_5||"");this._isDownloaded=false;if(this.parseOnLoad){this._createSubWidgets();}this._checkIfSingleChild();if(this._singleChild&&this._singleChild.resize){this._singleChild.resize(this._contentBox);}this._onLoadHandler();},cancel:function(){if(this._xhrDfd&&(this._xhrDfd.fired==-1)){this._xhrDfd.cancel();}delete this._xhrDfd;},destroy:function(){if(this._beingDestroyed){return;}this._onUnloadHandler();this._beingDestroyed=true;this.inherited("destroy",arguments);},resize:function(_6){dojo.marginBox(this.domNode,_6);var _7=this.containerNode||this.domNode,mb=dojo.mixin(dojo.marginBox(_7),_6||{});this._contentBox=dijit.layout.marginBox2contentBox(_7,mb);if(this._singleChild&&this._singleChild.resize){this._singleChild.resize(this._contentBox);}},_prepareLoad:function(_9){this.cancel();this.isLoaded=false;this._loadCheck(_9);},_loadCheck:function(_a){var _b=((this.open!==false)&&(this.domNode.style.display!="none"));if(this.href&&(_a||(this.preload&&!this._xhrDfd)||(this.refreshOnShow&&_b&&!this._xhrDfd)||(!this.isLoaded&&_b&&!this._xhrDfd))){this._downloadExternalContent();}},_downloadExternalContent:function(){this._onUnloadHandler();this._setContent(this.onDownloadStart.call(this));var _c=this;var _d={preventCache:(this.preventCache||this.refreshOnShow),url:this.href,handleAs:"text"};if(dojo.isObject(this.ioArgs)){dojo.mixin(_d,this.ioArgs);}var _e=this._xhrDfd=(this.ioMethod||dojo.xhrGet)(_d);_e.addCallback(function(_f){try{_c.onDownloadEnd.call(_c);_c._isDownloaded=true;_c.setContent.call(_c,_f);}catch(err){_c._onError.call(_c,"Content",err);}delete _c._xhrDfd;return _f;});_e.addErrback(function(err){if(!_e.cancelled){_c._onError.call(_c,"Download",err);}delete _c._xhrDfd;return err;});},_onLoadHandler:function(){this.isLoaded=true;try{this.onLoad.call(this);}catch(e){console.error("Error "+this.widgetId+" running custom onLoad code");}},_onUnloadHandler:function(){this.isLoaded=false;this.cancel();try{this.onUnload.call(this);}catch(e){console.error("Error "+this.widgetId+" running custom onUnload code");}},_setContent:function(_11){this.destroyDescendants();try{var _12=this.containerNode||this.domNode;while(_12.firstChild){dojo._destroyElement(_12.firstChild);}if(typeof _11=="string"){if(this.extractContent){match=_11.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);if(match){_11=match[1];}}_12.innerHTML=_11;}else{if(_11.nodeType){_12.appendChild(_11);}else{dojo.forEach(_11,function(n){_12.appendChild(n.cloneNode(true));});}}}catch(e){var _14=this.onContentError(e);try{_12.innerHTML=_14;}catch(e){console.error("Fatal "+this.id+" could not change content due to "+e.message,e);}}},_onError:function(_15,err,_17){var _18=this["on"+_15+"Error"].call(this,err);if(_17){console.error(_17,err);}else{if(_18){this._setContent.call(this,_18);}}},_createSubWidgets:function(){var _19=this.containerNode||this.domNode;try{dojo.parser.parse(_19,true);}catch(e){this._onError("Content",e,"Couldn't create widgets in "+this.id+(this.href?" from "+this.href:""));}},onLoad:function(e){},onUnload:function(e){},onDownloadStart:function(){return this.loadingMessage;},onContentError:function(_1c){},onDownloadError:function(_1d){return this.errorMessage;},onDownloadEnd:function(){}});}
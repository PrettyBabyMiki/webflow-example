/*
	Copyright (c) 2004-2007, The Dojo Foundation
	All Rights Reserved.

	Licensed under the Academic Free License version 2.1 or above OR the
	modified BSD license. For more information on Dojo licensing, see:

		http://dojotoolkit.org/book/dojo-book-0-9/introduction/licensing
*/


if(!dojo._hasResource["dijit._editor.RichText"]){dojo._hasResource["dijit._editor.RichText"]=true;dojo.provide("dijit._editor.RichText");dojo.require("dijit._Widget");dojo.require("dijit._editor.selection");dojo.require("dojo.i18n");dojo.requireLocalization("dijit","Textarea",null,"ROOT");if(!djConfig["useXDomain"]||djConfig["allowXdRichTextSave"]){if(dojo._postLoad){(function(){var _1=dojo.doc.createElement("textarea");_1.id="dijit._editor.RichText.savedContent";var s=_1.style;s.display="none";s.position="absolute";s.top="-100px";s.left="-100px";s.height="3px";s.width="3px";dojo.body().appendChild(_1);})();}else{try{dojo.doc.write("<textarea id=\"dijit._editor.RichText.savedContent\" "+"style=\"display:none;position:absolute;top:-100px;left:-100px;height:3px;width:3px;overflow:hidden;\"></textarea>");}catch(e){}}}dojo.declare("dijit._editor.RichText",[dijit._Widget],{constructor:function(){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this._keyHandlers={};this.contentPreFilters.push(dojo.hitch(this,"_preFixUrlAttributes"));if(dojo.isMoz){this.contentPreFilters.push(this._fixContentForMoz);}this.onLoadDeferred=new dojo.Deferred();},inheritWidth:false,focusOnLoad:false,name:"",styleSheets:"",_content:"",height:"300px",minHeight:"1em",isClosed:true,isLoaded:false,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",onLoadDeferred:null,postCreate:function(){dojo.publish("dijit._editor.RichText::init",[this]);this.open();this.setupDefaultShortcuts();},setupDefaultShortcuts:function(){var _3=this.KEY_CTRL;var _4=function(_5,_6){return arguments.length==1?function(){this.execCommand(_5);}:function(){this.execCommand(_5,_6);};};this.addKeyHandler("b",_3,_4("bold"));this.addKeyHandler("i",_3,_4("italic"));this.addKeyHandler("u",_3,_4("underline"));this.addKeyHandler("a",_3,_4("selectall"));this.addKeyHandler("s",_3,function(){this.save(true);});this.addKeyHandler("1",_3,_4("formatblock","h1"));this.addKeyHandler("2",_3,_4("formatblock","h2"));this.addKeyHandler("3",_3,_4("formatblock","h3"));this.addKeyHandler("4",_3,_4("formatblock","h4"));this.addKeyHandler("\\",_3,_4("insertunorderedlist"));if(!dojo.isIE){this.addKeyHandler("Z",_3,_4("redo"));}},events:["onKeyPress","onKeyDown","onKeyUp","onClick"],captureEvents:[],_editorCommandsLocalized:false,_localizeEditorCommands:function(){if(this._editorCommandsLocalized){return;}this._editorCommandsLocalized=true;var _7=["p","pre","address","h1","h2","h3","h4","h5","h6","ol","div","ul"];var _8="",_9,i=0;while((_9=_7[i++])){if(_9.charAt(1)!="l"){_8+="<"+_9+"><span>content</span></"+_9+">";}else{_8+="<"+_9+"><li>content</li></"+_9+">";}}var _b=document.createElement("div");_b.style.position="absolute";_b.style.left="-2000px";_b.style.top="-2000px";document.body.appendChild(_b);_b.innerHTML=_8;var _c=_b.firstChild;while(_c){dijit._editor.selection.selectElement(_c.firstChild);dojo.withGlobal(this.window,"selectElement",dijit._editor.selection,[_c.firstChild]);var _d=_c.tagName.toLowerCase();this._local2NativeFormatNames[_d]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[_d]]=_d;_c=_c.nextSibling;}document.body.removeChild(_b);},open:function(_e){if((!this.onLoadDeferred)||(this.onLoadDeferred.fired>=0)){this.onLoadDeferred=new dojo.Deferred();}if(!this.isClosed){this.close();}dojo.publish("dijit._editor.RichText::open",[this]);this._content="";if((arguments.length==1)&&(_e["nodeName"])){this.domNode=_e;}if((this.domNode["nodeName"])&&(this.domNode.nodeName.toLowerCase()=="textarea")){this.textarea=this.domNode;this.name=this.textarea.name;var _f=this._preFilterContent(this.textarea.value);this.domNode=dojo.doc.createElement("div");this.domNode.setAttribute("widgetId",this.id);this.textarea.removeAttribute("widgetId");this.domNode.cssText=this.textarea.cssText;this.domNode.className+=" "+this.textarea.className;dojo.place(this.domNode,this.textarea,"before");var _10=dojo.hitch(this,function(){with(this.textarea.style){display="block";position="absolute";left=top="-1000px";if(dojo.isIE){this.__overflow=overflow;overflow="hidden";}}});if(dojo.isIE){setTimeout(_10,10);}else{_10();}}else{var _f=this._preFilterContent(this.getNodeChildrenHtml(this.domNode));this.domNode.innerHTML="";}if(_f==""){_f="&nbsp;";}var _11=dojo.contentBox(this.domNode);this._oldHeight=_11.h;this._oldWidth=_11.w;this.savedContent=_f;if((this.domNode["nodeName"])&&(this.domNode.nodeName=="LI")){this.domNode.innerHTML=" <br>";}this.editingArea=dojo.doc.createElement("div");this.domNode.appendChild(this.editingArea);if(this.name!=""&&(!djConfig["useXDomain"]||djConfig["allowXdRichTextSave"])){var _12=dojo.byId("dijit._editor.RichText.savedContent");if(_12.value!=""){var _13=_12.value.split(this._SEPARATOR),i=0,dat;while((dat=_13[i++])){var _16=dat.split(":");if(_16[0]==this.name){_f=_16[1];_13.splice(i,1);break;}}}dojo.connect(window,"onbeforeunload",this,"_saveContent");}this.isClosed=false;if(dojo.isIE||dojo.isSafari||dojo.isOpera){var ifr=this.iframe=dojo.doc.createElement("iframe");ifr.src="javascript:void(0)";this.editorObject=ifr;ifr.style.border="none";ifr.style.width="100%";ifr.frameBorder=0;this.editingArea.appendChild(ifr);this.window=ifr.contentWindow;this.document=this.window.document;this.document.open();this.document.write(this._getIframeDocTxt(_f));this.document.close();if(dojo.isIE>=7){if(this.height){ifr.style.height=this.height;}if(this.minHeight){ifr.style.minHeight=this.minHeight;}}else{ifr.style.height=this.height?this.height:this.minHeight;}if(dojo.isIE){this._localizeEditorCommands();}this.onLoad();}else{this._drawIframe(_f);}if(this.domNode.nodeName=="LI"){this.domNode.lastChild.style.marginTop="-1.2em";}this.domNode.className+=" RichTextEditable";},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_localizedIframeTitles:null,_getIframeDocTxt:function(_18){var _cs=dojo.getComputedStyle(this.domNode);if(!this.height&&!dojo.isMoz){_18="<div>"+_18+"</div>";}var _1a=[_cs.fontWeight,_cs.fontSize,_cs.fontFamily].join(" ");var _1b=_cs.lineHeight;if(_1b.indexOf("px")>=0){_1b=parseFloat(_1b)/parseFloat(_cs.fontSize);}else{if(_1b.indexOf("em")>=0){_1b=parseFloat(_1b);}else{_1b="1.0";}}return [this.isLeftToRight()?"<html><head>":"<html dir='rtl'><head>",(dojo.isMoz?"<title>"+this._localizedIframeTitles.iframeEditTitle+"</title>":""),"<style>","body,html {","\tbackground:transparent;","\tpadding: 0;","\tmargin: 0;","}","body{","\ttop:0px; left:0px; right:0px;",((this.height||dojo.isOpera)?"":"position: fixed;"),"\tfont:",_1a,";","\tmin-height:",this.minHeight,";","\tline-height:",_1b,"}","p{ margin: 1em 0 !important; }",(this.height?"":"body,html{overflow-y:hidden;/*for IE*/} body > div {overflow-x:auto;/*for FF to show vertical scrollbar*/}"),"li > ul:-moz-first-node, li > ol:-moz-first-node{ padding-top: 1.2em; } ","li{ min-height:1.2em; }","</style>",this._applyEditingAreaStyleSheets(),"</head><body>"+_18+"</body></html>"].join("");},_drawIframe:function(_1c){if(!this.iframe){var ifr=this.iframe=dojo.doc.createElement("iframe");var _1e=ifr.style;_1e.border="none";_1e.lineHeight="0";_1e.verticalAlign="bottom";this.editorObject=this.iframe;this._localizedIframeTitles=dojo.i18n.getLocalization("dijit","Textarea");var _1f=dojo.query("label[for=\""+this.id+"\"]");if(_1f.length){this._localizedIframeTitles.iframeEditTitle=_1f[0].innerHTML+" "+this._localizedIframeTitles.iframeEditTitle;}}this.iframe.style.width=this.inheritWidth?this._oldWidth:"100%";if(this.height){this.iframe.style.height=this.height;}else{this.iframe.height=this._oldHeight;}if(this.textarea){var _20=this.srcNodeRef;}else{var _20=dojo.doc.createElement("div");_20.style.display="none";_20.innerHTML=_1c;this.editingArea.appendChild(_20);}this.editingArea.appendChild(this.iframe);var _21=false;var _22=this.iframe.contentDocument;_22.open();_22.write(this._getIframeDocTxt(_1c));_22.close();var _23=dojo.hitch(this,function(){if(!_21){_21=true;}else{return;}if(!this.editNode){try{if(this.iframe.contentWindow){this.window=this.iframe.contentWindow;this.document=this.iframe.contentWindow.document;}else{if(this.iframe.contentDocument){this.window=this.iframe.contentDocument.window;this.document=this.iframe.contentDocument;}}if(!this.document.body){throw "Error";}}catch(e){setTimeout(_23,500);_21=false;return;}dojo._destroyElement(_20);this.document.designMode="on";this.onLoad();}else{dojo._destroyElement(_20);this.editNode.innerHTML=_1c;this.onDisplayChanged();}this._preDomFilterContent(this.editNode);});_23();},_applyEditingAreaStyleSheets:function(){var _24=[];if(this.styleSheets){_24=this.styleSheets.split(";");this.styleSheets="";}_24=_24.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];var _25="",i=0,url;while((url=_24[i++])){var _28=(new dojo._Url(dojo.global.location,url)).toString();this.editingAreaStyleSheets.push(_28);_25+="<link rel=\"stylesheet\" type=\"text/css\" href=\""+_28+"\"/>";}return _25;},addStyleSheet:function(uri){var url=uri.toString();if(url.charAt(0)=="."||(url.charAt(0)!="/"&&!uri.host)){url=(new dojo._Url(dojo.global.location,url)).toString();}if(dojo.indexOf(this.editingAreaStyleSheets,url)>-1){console.debug("dijit._editor.RichText.addStyleSheet: Style sheet "+url+" is already applied to the editing area!");return;}this.editingAreaStyleSheets.push(url);if(this.document.createStyleSheet){this.document.createStyleSheet(url);}else{var _2b=this.document.getElementsByTagName("head")[0];var _2c=this.document.createElement("link");with(_2c){rel="stylesheet";type="text/css";href=url;}_2b.appendChild(_2c);}},removeStyleSheet:function(uri){var url=uri.toString();if(url.charAt(0)=="."||(url.charAt(0)!="/"&&!uri.host)){url=(new dojo._Url(dojo.global.location,url)).toString();}var _2f=dojo.indexOf(this.editingAreaStyleSheets,url);if(_2f==-1){console.debug("dijit._editor.RichText.removeStyleSheet: Style sheet "+url+" is not applied to the editing area so it can not be removed!");return;}delete this.editingAreaStyleSheets[_2f];dojo.withGlobal(this.window,"query",dojo,["link:[href=\""+url+"\"]"]).orphan();},disabled:false,_mozSettingProps:["styleWithCSS","insertBrOnReturn"],setDisabled:function(_30){if(dojo.isIE||dojo.isSafari||dojo.isOpera){this.editNode.contentEditable=!_30;}else{if(_30){this._mozSettings=[false,this.blockNodeForEnter==="BR"];}this.document.designMode=(_30?"off":"on");if(!_30){dojo.forEach(this._mozSettingProps,function(s,i){this.document.execCommand(s,false,this._mozSettings[i]);},this);}}this.disabled=_30;},_isResized:function(){return false;},onLoad:function(e){this.isLoaded=true;if(this.height||dojo.isMoz){this.editNode=this.document.body;}else{this.editNode=this.document.body.firstChild;}this.editNode.contentEditable=true;this._preDomFilterContent(this.editNode);var _34=this.events.concat(this.captureEvents),i=0,et;while((et=_34[i++])){this.connect(this.document,et.toLowerCase(),et);}if(!dojo.isIE){try{this.document.execCommand("styleWithCSS",false,false);}catch(e2){}}else{this.editNode.style.zoom=1;}if(this.focusOnLoad){this.focus();}this.onDisplayChanged(e);if(this.onLoadDeferred){this.onLoadDeferred.callback(true);}},onKeyDown:function(e){if(dojo.isIE){if(e.keyCode===dojo.keys.BACKSPACE&&this.document.selection.type==="Control"){dojo.stopEvent(e);this.execCommand("delete");}else{if((65<=e.keyCode&&e.keyCode<=90)||(e.keyCode>=37&&e.keyCode<=40)){e.charCode=e.keyCode;this.onKeyPress(e);}}}else{if(dojo.isMoz){if(e.keyCode==dojo.keys.TAB&&!e.shiftKey&&!e.ctrlKey&&!e.altKey&&this.iframe){this.iframe.contentDocument.title=this._localizedIframeTitles.iframeFocusTitle;this.iframe.focus();dojo.stopEvent(e);}else{if(e.keyCode==dojo.keys.TAB&&e.shiftKey){if(this.toolbar){this.toolbar.focus();}dojo.stopEvent(e);}}}}},onKeyUp:function(e){return;},KEY_CTRL:1,KEY_SHIFT:2,onKeyPress:function(e){var _3a=e.ctrlKey?this.KEY_CTRL:0|e.shiftKey?this.KEY_SHIFT:0;var key=e.keyChar||e.keyCode;if(this._keyHandlers[key]){var _3c=this._keyHandlers[key],i=0,h;while((h=_3c[i++])){if(_3a==h.modifiers){if(!h.handler.apply(this,arguments)){e.preventDefault();}break;}}}setTimeout(dojo.hitch(this,function(){this.onKeyPressed(e);}),1);},addKeyHandler:function(key,_40,_41){if(!dojo.isArray(this._keyHandlers[key])){this._keyHandlers[key]=[];}this._keyHandlers[key].push({modifiers:_40||0,handler:_41});},onKeyPressed:function(e){this.onDisplayChanged();},onClick:function(e){this.onDisplayChanged(e);},_onBlur:function(e){var _c=this.getValue(true);if(_c!=this.savedContent){this.onChange(_c);this.savedContent=_c;}if(dojo.isMoz&&this.iframe){this.iframe.contentDocument.title=this._localizedIframeTitles.iframeEditTitle;}},_initialFocus:true,_onFocus:function(e){if((dojo.isMoz)&&(this._initialFocus)){this._initialFocus=false;if(this.editNode.innerHTML.replace(/^\s+|\s+$/g,"")=="&nbsp;"){this.placeCursorAtStart();}}},blur:function(){if(this.iframe){this.window.blur();}else{if(this.editNode){this.editNode.blur();}}},focus:function(){if(this.iframe&&!dojo.isIE){dijit.focus(this.iframe);}else{if(this.editNode&&this.editNode.focus){dijit.focus(this.editNode);}else{console.debug("Have no idea how to focus into the editor!");}}},updateInterval:200,_updateTimer:null,onDisplayChanged:function(e){if(!this._updateTimer){if(this._updateTimer){clearTimeout(this._updateTimer);}this._updateTimer=setTimeout(dojo.hitch(this,this.onNormalizedDisplayChanged),this.updateInterval);}},onNormalizedDisplayChanged:function(){this._updateTimer=null;},onChange:function(_48){},_normalizeCommand:function(cmd){var _4a=cmd.toLowerCase();if(_4a=="formatblock"){if(dojo.isSafari){_4a="heading";}}else{if(_4a=="hilitecolor"&&!dojo.isMoz){_4a="backcolor";}}return _4a;},queryCommandAvailable:function(_4b){var ie=1;var _4d=1<<1;var _4e=1<<2;var _4f=1<<3;var _50=1<<4;var _51=dojo.isSafari;function isSupportedBy(_52){return {ie:Boolean(_52&ie),mozilla:Boolean(_52&_4d),safari:Boolean(_52&_4e),safari420:Boolean(_52&_50),opera:Boolean(_52&_4f)};};var _53=null;switch(_4b.toLowerCase()){case "bold":case "italic":case "underline":case "subscript":case "superscript":case "fontname":case "fontsize":case "forecolor":case "hilitecolor":case "justifycenter":case "justifyfull":case "justifyleft":case "justifyright":case "delete":case "selectall":_53=isSupportedBy(_4d|ie|_4e|_4f);break;case "createlink":case "unlink":case "removeformat":case "inserthorizontalrule":case "insertimage":case "insertorderedlist":case "insertunorderedlist":case "indent":case "outdent":case "formatblock":case "inserthtml":case "undo":case "redo":case "strikethrough":_53=isSupportedBy(_4d|ie|_4f|_50);break;case "blockdirltr":case "blockdirrtl":case "dirltr":case "dirrtl":case "inlinedirltr":case "inlinedirrtl":_53=isSupportedBy(ie);break;case "cut":case "copy":case "paste":_53=isSupportedBy(ie|_4d|_50);break;case "inserttable":_53=isSupportedBy(_4d|ie);break;case "insertcell":case "insertcol":case "insertrow":case "deletecells":case "deletecols":case "deleterows":case "mergecells":case "splitcell":_53=isSupportedBy(ie|_4d);break;default:return false;}return (dojo.isIE&&_53.ie)||(dojo.isMoz&&_53.mozilla)||(dojo.isSafari&&_53.safari)||(_51&&_53.safari420)||(dojo.isOpera&&_53.opera);},execCommand:function(_54,_55){var _56;this.focus();_54=this._normalizeCommand(_54);if(_55!=undefined){if(_54=="heading"){throw new Error("unimplemented");}else{if((_54=="formatblock")&&dojo.isIE){_55="<"+_55+">";}}}if(_54=="inserthtml"){_55=this._preFilterContent(_55);if(dojo.isIE){var _57=this.document.selection.createRange();_57.pasteHTML(_55);_57.select();_56=true;}else{if(dojo.isMoz&&!_55.length){dojo.withGlobal(this.window,"remove",dijit._editor.selection);_56=true;}else{_56=this.document.execCommand(_54,false,_55);}}}else{if((_54=="unlink")&&(this.queryCommandEnabled("unlink"))&&(dojo.isMoz||dojo.isSafari)){var _58=this.window.getSelection();var a=dojo.withGlobal(this.window,"getAncestorElement",dijit._editor.selection,["a"]);dojo.withGlobal(this.window,"selectElement",dijit._editor.selection,[a]);_56=this.document.execCommand("unlink",false,null);}else{if((_54=="hilitecolor")&&(dojo.isMoz)){this.document.execCommand("styleWithCSS",false,true);_56=this.document.execCommand(_54,false,_55);this.document.execCommand("styleWithCSS",false,false);}else{if((dojo.isIE)&&((_54=="backcolor")||(_54=="forecolor"))){_55=arguments.length>1?_55:null;_56=this.document.execCommand(_54,false,_55);}else{_55=arguments.length>1?_55:null;if(_55||_54!="createlink"){_56=this.document.execCommand(_54,false,_55);}}}}}this.onDisplayChanged();return _56;},queryCommandEnabled:function(_5a){_5a=this._normalizeCommand(_5a);if(dojo.isMoz||dojo.isSafari){if(_5a=="unlink"){return dojo.withGlobal(this.window,"hasAncestorElement",dijit._editor.selection,["a"]);}else{if(_5a=="inserttable"){return true;}}}if(dojo.isSafari){if(_5a=="copy"){_5a="cut";}else{if(_5a=="paste"){return true;}}}var _5b=(dojo.isIE)?this.document.selection.createRange():this.document;return _5b.queryCommandEnabled(_5a);},queryCommandState:function(_5c){_5c=this._normalizeCommand(_5c);return this.document.queryCommandState(_5c);},queryCommandValue:function(_5d){_5d=this._normalizeCommand(_5d);if(dojo.isIE&&_5d=="formatblock"){return this._local2NativeFormatNames[this.document.queryCommandValue(_5d)];}return this.document.queryCommandValue(_5d);},placeCursorAtStart:function(){this.focus();var _5e=false;if(dojo.isMoz){var _5f=this.editNode.firstChild;while(_5f){if(_5f.nodeType==3){if(_5f.nodeValue.replace(/^\s+|\s+$/g,"").length>0){_5e=true;dojo.withGlobal(this.window,"selectElement",dijit._editor.selection,[_5f]);break;}}else{if(_5f.nodeType==1){_5e=true;dojo.withGlobal(this.window,"selectElementChildren",dijit._editor.selection,[_5f]);break;}}_5f=_5f.nextSibling;}}else{_5e=true;dojo.withGlobal(this.window,"selectElementChildren",dijit._editor.selection,[this.editNode]);}if(_5e){dojo.withGlobal(this.window,"collapse",dijit._editor.selection,[true]);}},placeCursorAtEnd:function(){this.focus();var _60=false;if(dojo.isMoz){var _61=this.editNode.lastChild;while(_61){if(_61.nodeType==3){if(_61.nodeValue.replace(/^\s+|\s+$/g,"").length>0){_60=true;dojo.withGlobal(this.window,"selectElement",dijit._editor.selection,[_61]);break;}}else{if(_61.nodeType==1){_60=true;if(_61.lastChild){dojo.withGlobal(this.window,"selectElement",dijit._editor.selection,[_61.lastChild]);}else{dojo.withGlobal(this.window,"selectElement",dijit._editor.selection,[_61]);}break;}}_61=_61.previousSibling;}}else{_60=true;dojo.withGlobal(this.window,"selectElementChildren",dijit._editor.selection,[this.editNode]);}if(_60){dojo.withGlobal(this.window,"collapse",dijit._editor.selection,[false]);}},getValue:function(_62){if(this.textarea){if(this.isClosed||!this.isLoaded){return this.textarea.value;}}return this._postFilterContent(null,_62);},setValue:function(_63){if(this.textarea&&(this.isClosed||!this.isLoaded)){this.textarea.value=_63;}else{_63=this._preFilterContent(_63);if(this.isClosed){this.domNode.innerHTML=_63;this._preDomFilterContent(this.domNode);}else{this.editNode.innerHTML=_63;this._preDomFilterContent(this.editNode);}}},replaceValue:function(_64){if(this.isClosed){this.setValue(_64);}else{if(this.window&&this.window.getSelection&&!dojo.isMoz){this.setValue(_64);}else{if(this.window&&this.window.getSelection){_64=this._preFilterContent(_64);this.execCommand("selectall");if(dojo.isMoz&&!_64){_64="&nbsp;";}this.execCommand("inserthtml",_64);this._preDomFilterContent(this.editNode);}else{if(this.document&&this.document.selection){this.setValue(_64);}}}}},_preFilterContent:function(_65){var ec=_65;dojo.forEach(this.contentPreFilters,function(ef){if(ef){ec=ef(ec);}});return ec;},_preDomFilterContent:function(dom){dom=dom||this.editNode;dojo.forEach(this.contentDomPreFilters,function(ef){if(ef&&dojo.isFunction(ef)){ef(dom);}},this);},_postFilterContent:function(dom,_6b){dom=dom||this.editNode;if(this.contentDomPostFilters.length){if(_6b&&dom["cloneNode"]){dom=dom.cloneNode(true);}dojo.forEach(this.contentDomPostFilters,function(ef){dom=ef(dom);});}var ec=this.getNodeChildrenHtml(dom);if(!ec.replace(/^(?:\s|\xA0)+/g,"").replace(/(?:\s|\xA0)+$/g,"").length){ec="";}dojo.forEach(this.contentPostFilters,function(ef){ec=ef(ec);});return ec;},_saveContent:function(e){var _70=dojo.byId("dijit._editor.RichText.savedContent");_70.value+=this._SEPARATOR+this.name+":"+this.getValue();},escapeXml:function(str,_72){str=str.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;");if(!_72){str=str.replace(/'/gm,"&#39;");}return str;},getNodeHtml:function(_73){switch(_73.nodeType){case 1:var _74="<"+_73.tagName.toLowerCase();if(dojo.isMoz){if(_73.getAttribute("type")=="_moz"){_73.removeAttribute("type");}if(_73.getAttribute("_moz_dirty")!=undefined){_73.removeAttribute("_moz_dirty");}}var _75=[];if(dojo.isIE){var s=_73.outerHTML;s=s.substr(0,s.indexOf(">"));s=s.replace(/(?:['"])[^"']*\1/g,"");var reg=/([^\s=]+)=/g;var m,key;while((m=reg.exec(s))!=undefined){key=m[1];if(key.substr(0,3)!="_dj"){if(key=="src"||key=="href"){if(_73.getAttribute("_djrealurl")){_75.push([key,_73.getAttribute("_djrealurl")]);continue;}}if(key=="class"){_75.push([key,_73.className]);}else{_75.push([key,_73.getAttribute(key)]);}}}}else{var _7a,i=0,_7c=_73.attributes;while((_7a=_7c[i++])){if(_7a.name.substr(0,3)!="_dj"){var v=_7a.value;if(_7a.name=="src"||_7a.name=="href"){if(_73.getAttribute("_djrealurl")){v=_73.getAttribute("_djrealurl");}}_75.push([_7a.name,v]);}}}_75.sort(function(a,b){return a[0]<b[0]?-1:(a[0]==b[0]?0:1);});i=0;while((_7a=_75[i++])){_74+=" "+_7a[0]+"=\""+_7a[1]+"\"";}if(_73.childNodes.length){_74+=">"+this.getNodeChildrenHtml(_73)+"</"+_73.tagName.toLowerCase()+">";}else{_74+=" />";}break;case 3:var _74=this.escapeXml(_73.nodeValue,true);break;case 8:var _74="<!--"+this.escapeXml(_73.nodeValue,true)+"-->";break;default:var _74="Element not recognized - Type: "+_73.nodeType+" Name: "+_73.nodeName;}return _74;},getNodeChildrenHtml:function(dom){var out="";if(!dom){return out;}var _82=dom["childNodes"]||dom;var i=0;var _84;while((_84=_82[i++])){out+=this.getNodeHtml(_84);}return out;},close:function(_85,_86){if(this.isClosed){return false;}if(!arguments.length){_85=true;}this._content=this.getValue();var _87=(this.savedContent!=this._content);if(this.interval){clearInterval(this.interval);}if(this.textarea){with(this.textarea.style){position="";left=top="";if(dojo.isIE){overflow=this.__overflow;this.__overflow=null;}}if(_85){this.textarea.value=this._content;}else{this.textarea.value=this.savedContent;}dojo._destroyElement(this.domNode);this.domNode=this.textarea;}else{if(_85){this.domNode.innerHTML=this._content;}else{this.domNode.innerHTML=this.savedContent;}}dojo.removeClass(this.domNode,"RichTextEditable");this.isClosed=true;this.isLoaded=false;delete this.editNode;if(this.window&&this.window._frameElement){this.window._frameElement=null;}this.window=null;this.document=null;this.editingArea=null;this.editorObject=null;return _87;},destroyRendering:function(){},destroy:function(){this.destroyRendering();if(!this.isClosed){this.close(false);}this.inherited("destroy",arguments);},_fixContentForMoz:function(_88){_88=_88.replace(/<(\/)?strong([ \>])/gi,"<$1b$2");_88=_88.replace(/<(\/)?em([ \>])/gi,"<$1i$2");return _88;},_srcInImgRegex:/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,_hrefInARegex:/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,_preFixUrlAttributes:function(_89){_89=_89.replace(this._hrefInARegex,"$1$4$2$3$5$2 _djrealurl=$2$3$5$2");_89=_89.replace(this._srcInImgRegex,"$1$4$2$3$5$2 _djrealurl=$2$3$5$2");return _89;}});}
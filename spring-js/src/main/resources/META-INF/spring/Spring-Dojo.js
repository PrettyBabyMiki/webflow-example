/*
 * Copyright 2004-2008 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
dojo.declare("Spring.DefaultEquals",null,{equals:function(_1){if(_1.declaredClass&&_1.declaredClass==this.declaredClass){return true;}else{return false;}}});dojo.declare("Spring.ElementDecoration",[Spring.AbstractElementDecoration,Spring.DefaultEquals],{constructor:function(_2){this.copyFields=new Array("name","value","type","checked","selected","readOnly","disabled","alt","maxLength","class","title");dojo.mixin(this,_2);if(this.widgetModule==""){this.widgetModule=this.widgetType;}},apply:function(){if(dijit.byId(this.elementId)){dijit.byId(this.elementId).destroyRecursive(false);}var _3=dojo.byId(this.elementId);if(!_3){console.error("Could not apply "+this.widgetType+" decoration.  Element with id '"+this.elementId+"' not found in the DOM.");}else{var _4=this.widgetAttrs["datePattern"];if(_4&&this.widgetType=="dijit.form.DateTextBox"){if(!this.widgetAttrs["value"]){this.widgetAttrs["value"]=dojo.date.locale.parse(_3.value,{selector:"date",datePattern:_4});}if(!this.widgetAttrs["serialize"]){this.widgetAttrs["serialize"]=function(d,_6){return dojo.date.locale.format(d,{selector:"date",datePattern:_4});};}}for(var _7 in this.copyFields){_7=this.copyFields[_7];if(!this.widgetAttrs[_7]&&_3[_7]&&(typeof _3[_7]!="number"||(typeof _3[_7]=="number"&&_3[_7]>=0))){this.widgetAttrs[_7]=_3[_7];}}if(_3["style"]&&_3["style"].cssText){this.widgetAttrs["style"]=_3["style"].cssText;}dojo.require(this.widgetModule);var _8=dojo.eval(this.widgetType);this.widget=new _8(this.widgetAttrs,_3);this.widget.startup();}return this;},validate:function(){if(!this.widget.isValid){return true;}var _9=this.widget.isValid(false);if(!_9){this.widget.state="Error";this.widget._setStateClass();}return _9;}});dojo.declare("Spring.ValidateAllDecoration",[Spring.AbstractValidateAllDecoration,Spring.DefaultEquals],{constructor:function(_a){this.originalHandler=null;this.connection=null;dojo.mixin(this,_a);},apply:function(){var _b=dojo.byId(this.elementId);if(!_b){console.error("Could not apply ValidateAll decoration.  Element with id '"+this.elementId+"' not found in the DOM.");}else{this.originalHandler=_b[this.event];var _c=this;_b[this.event]=function(_d){_c.handleEvent(_d,_c);};}return this;},cleanup:function(){dojo.disconnect(this.connection);},handleEvent:function(_e,_f){if(!Spring.validateAll()){dojo.publish(this.elementId+"/validation",[false]);dojo.stopEvent(_e);}else{dojo.publish(this.elementId+"/validation",[true]);if(dojo.isFunction(_f.originalHandler)){var _10=_f.originalHandler(_e);if(_10==false){dojo.stopEvent(_e);}}}}});dojo.declare("Spring.AjaxEventDecoration",[Spring.AbstractAjaxEventDecoration,Spring.DefaultEquals],{constructor:function(_11){this.validationSubscription=null;this.connection=null;this.allowed=true;dojo.mixin(this,_11);},apply:function(){var _12=dojo.byId(this.elementId);if(!_12){console.error("Could not apply AjaxEvent decoration.  Element with id '"+this.elementId+"' not found in the DOM.");}else{this.validationSubscription=dojo.subscribe(this.elementId+"/validation",this,"_handleValidation");this.connection=dojo.connect(_12,this.event,this,"submit");}return this;},cleanup:function(){dojo.unsubscribe(this.validationSubscription);dojo.disconnect(this.connection);},submit:function(_13){if(this.sourceId==""){this.sourceId=this.elementId;}if(this.formId==""){Spring.remoting.getLinkedResource(this.sourceId,this.params,this.popup);}else{if(this.allowed){Spring.remoting.submitForm(this.sourceId,this.formId,this.params);}}dojo.stopEvent(_13);},_handleValidation:function(_14){if(!_14){this.allowed=false;}else{this.allowed=true;}}});dojo.declare("Spring.RemotingHandler",Spring.AbstractRemotingHandler,{constructor:function(){},submitForm:function(_15,_16,_17){var _18=new Object();for(var key in _17){_18[key]=_17[key];}var _1a=dojo.byId(_15);if(_1a!=null){if(_1a.value!=undefined&&_1a.type&&("button,submit,reset").indexOf(_1a.type)<0){_18[_15]=_1a.value;}else{if(_1a.name!=undefined){_18[_1a.name]=_1a.name;}else{_18[_15]=_15;}}}if(!_18["ajaxSource"]){_18["ajaxSource"]=_15;}var _1b=dojo.byId(_16);var _1c=dojo.string.trim(_1b.method);_1c=_1c.length>0?_1c.toUpperCase():"GET";dojo.xhr(_1c,{content:_18,form:_16,handleAs:"text",headers:{"Accept":"text/html;type=ajax"},load:this.handleResponse,error:this.handleError},_1c=="POST"?true:false);},getLinkedResource:function(_1d,_1e,_1f){this.getResource(dojo.byId(_1d).href,_1e,_1f);},getResource:function(_20,_21,_22){dojo.xhrGet({url:_20,content:_21,handleAs:"text",headers:{"Accept":"text/html;type=ajax"},load:this.handleResponse,error:this.handleError,modal:_22});},handleResponse:function(_23,_24){var _25=_24.xhr.getResponseHeader("Spring-Redirect-URL");var _26=_24.xhr.getResponseHeader("Spring-Modal-View");var _27=((dojo.isString(_26)&&_26.length>0)||_24.args.modal);if(dojo.isString(_25)&&_25.length>0){if(_27){Spring.remoting.renderURLToModalDialog(_25);return _23;}else{if(_25.indexOf("/")>=0){window.location=window.location.protocol+"//"+window.location.host+_25;}else{var _28=window.location.protocol+"//"+window.location.host+window.location.pathname;var _29=_28.lastIndexOf("/");_28=_28.substr(0,_29+1)+_25;if(_28==window.location){Spring.remoting.getResource(_28,_24.args.content,false);}else{window.location=_28;}}return _23;}}var _2a="(?:<script(.|[\n|\r])*?>)((\n|\r|.)*?)(?:</script>)";var _2b=[];var _2c=new RegExp(_2a,"img");var _2d=new RegExp(_2a,"im");var _2e=_23.match(_2c);if(_2e!=null){for(var i=0;i<_2e.length;i++){var _30=(_2e[i].match(_2d)||["","",""])[2];_30=_30.replace(/<!--/mg,"").replace(/\/\/-->/mg,"").replace(/<!\[CDATA\[(\/\/>)*/mg,"").replace(/(<!)*\]\]>/mg,"");_2b.push(_30);}}_23=_23.replace(_2c,"");var _31=dojo.doc.createElement("span");_31.id="ajaxResponse";_31.style.visibility="hidden";document.body.appendChild(_31);_31.innerHTML=_23;var _32=new dojo.NodeList(_31);var _33=_32.query("#ajaxResponse > *").orphan();_32.orphan();if(_27){Spring.remoting.renderNodeListToModalDialog(_33);}else{_33.forEach(function(_34){if(_34.id!=null&&_34.id!=""){var _35=dojo.byId(_34.id);if(!_35){console.error("An existing DOM elment with id '"+_34.id+"' could not be found for replacement.");}else{_35.parentNode.replaceChild(_34,_35);}}});}dojo.forEach(_2b,function(_36){dojo.eval(_36);});return _23;},handleError:function(_37,_38){dojo.require("dijit.Dialog");console.error("HTTP status code: ",_38.xhr.status);if(Spring.debug&&_38.xhr.status!=200){var _39=new dijit.Dialog({});dojo.connect(_39,"hide",_39,function(){this.destroyRecursive(false);});_39.domNode.style.width="80%";_39.domNode.style.height="80%";_39.domNode.style.textAlign="left";_39.setContent(_38.xhr.responseText);_39.show();}return _37;},renderURLToModalDialog:function(url){Spring.remoting.getResource(url,{},true);},renderNodeListToModalDialog:function(_3b){dojo.require("dijit.Dialog");var _3c=new dijit.Dialog({});_3c.setContent(_3b);dojo.connect(_3c,"hide",_3c,function(){this.destroyRecursive(false);});_3c.show();}});dojo.declare("Spring.CommandLinkDecoration",[Spring.AbstractCommandLinkDecoration,Spring.DefaultEquals],{constructor:function(_3d){dojo.mixin(this,_3d);},apply:function(){var _3e=dojo.byId(this.elementId);if(!dojo.hasClass(_3e,"progressiveLink")){var _3f=new dojo.NodeList(_3e);_3f.addContent(this.linkHtml,"after").orphan("*");_3e=dojo.byId(this.elementId);}_3e.submitFormFromLink=this.submitFormFromLink;return this;},submitFormFromLink:function(_40,_41,_42){var _43=[];var _44=dojo.byId(_40);var _45=document.createElement("input");_45.name=_41;_45.value="submitted";_43.push(_45);dojo.forEach(_42,function(_46){var _47=document.createElement("input");_47.name=_46.name;_47.value=_46.value;_43.push(_47);});dojo.forEach(_43,function(_48){dojo.addClass(_48,"SpringLinkInput");dojo.place(_48,_44,"last");});if((_44.onsubmit?!_44.onsubmit():false)||!_44.submit()){dojo.forEach(_43,function(_49){_49.parentNode.removeChild(_49);});}}});dojo.addOnLoad(Spring.initialize);
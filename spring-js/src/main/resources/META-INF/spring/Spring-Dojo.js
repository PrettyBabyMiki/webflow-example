/*
 * Copyright 2004-2008 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
dojo.declare("Spring.DefaultEquals",null,{equals:function(_1){if(_1.declaredClass&&_1.declaredClass==this.declaredClass){return true;}else{return false;}}});dojo.declare("Spring.ElementDecoration",[Spring.AbstractElementDecoration,Spring.DefaultEquals],{constructor:function(_2){this.copyFields=new Array("name","value","type","checked","selected","readOnly","disabled","alt","maxLength","class","title");dojo.mixin(this,_2);if(this.widgetModule==""){this.widgetModule=this.widgetType;}},apply:function(){if(dijit.byId(this.elementId)){dijit.byId(this.elementId).destroyRecursive(false);}var _3=dojo.byId(this.elementId);if(!_3){console.error("Could not apply "+this.widgetType+" decoration.  Element with id '"+this.elementId+"' not found in the DOM.");}else{var _4=this.widgetAttrs["datePattern"];if(_4&&this.widgetType=="dijit.form.DateTextBox"){if(!this.widgetAttrs["value"]){this.widgetAttrs["value"]=dojo.date.locale.parse(_3.value,{selector:"date",datePattern:_4});}if(!this.widgetAttrs["serialize"]){this.widgetAttrs["serialize"]=function(d,_6){return dojo.date.locale.format(d,{selector:"date",datePattern:_4});};}}for(var _7 in this.copyFields){_7=this.copyFields[_7];if(!this.widgetAttrs[_7]&&_3[_7]&&(typeof _3[_7]!="number"||(typeof _3[_7]=="number"&&_3[_7]>=0))){this.widgetAttrs[_7]=_3[_7];}}if(_3["style"]&&_3["style"].cssText){this.widgetAttrs["style"]=_3["style"].cssText;}dojo.require(this.widgetModule);var _8=dojo.eval(this.widgetType);this.widget=new _8(this.widgetAttrs,_3);this.widget.startup();}return this;},validate:function(){if(!this.widget.isValid){return true;}var _9=this.widget.isValid(false);if(!_9){this.widget.state="Error";this.widget._setStateClass();}return _9;}});dojo.declare("Spring.ValidateAllDecoration",[Spring.AbstractValidateAllDecoration,Spring.DefaultEquals],{constructor:function(_a){this.originalHandler=null;this.connection=null;dojo.mixin(this,_a);},apply:function(){var _b=dojo.byId(this.elementId);this.originalHandler=_b[this.event];var _c=this;_b[this.event]=function(_d){_c.handleEvent(_d,_c);};return this;},cleanup:function(){dojo.disconnect(this.connection);},handleEvent:function(_e,_f){_e.springValidateAll=Spring.validateAll();if(!_e.springValidateAll){dojo.stopEvent(_e);}else{if(dojo.isFunction(_f.originalHandler)){var _10=_f.originalHandler(_e);if(_10==false){dojo.stopEvent(_e);}}}}});dojo.declare("Spring.AjaxEventDecoration",[Spring.AbstractAjaxEventDecoration,Spring.DefaultEquals],{constructor:function(_11){this.connection=null;dojo.mixin(this,_11);},apply:function(){this.connection=dojo.connect(dojo.byId(this.elementId),this.event,this,"submit");return this;},cleanup:function(){dojo.disconnect(this.connection);},submit:function(_12){if(this.sourceId==""){this.sourceId=this.elementId;}if(this.formId==""){Spring.remoting.getLinkedResource(this.sourceId,this.params,this.popup);}else{if(_12.springValidateAll){Spring.remoting.submitForm(this.sourceId,this.formId,this.params);}}dojo.stopEvent(_12);}});dojo.declare("Spring.RemotingHandler",Spring.AbstractRemotingHandler,{constructor:function(){},submitForm:function(_13,_14,_15){var _16=new Object();for(var key in _15){_16[key]=_15[key];}var _18=dojo.byId(_13);if(_18!=null){if(_18.value!=undefined&&_18.type&&("button,submit,reset").indexOf(_18.type)<0){_16[_13]=_18.value;}else{if(_18.name!=undefined){_16[_18.name]=_18.name;}else{_16[_13]=_13;}}}if(!_16["ajaxSource"]){_16["ajaxSource"]=_13;}dojo.xhrPost({content:_16,form:_14,handleAs:"text",headers:{"Accept":"text/html;type=ajax"},load:this.handleResponse,error:this.handleError});},getLinkedResource:function(_19,_1a,_1b){this.getResource(dojo.byId(_19).href,_1a,_1b);},getResource:function(_1c,_1d,_1e){dojo.xhrGet({url:_1c,content:_1d,handleAs:"text",headers:{"Accept":"text/html;type=ajax"},load:this.handleResponse,error:this.handleError,modal:_1e});},handleResponse:function(_1f,_20){var _21=_20.xhr.getResponseHeader("Spring-Redirect-URL");var _22=_20.xhr.getResponseHeader("Spring-Modal-View");var _23=((dojo.isString(_22)&&_22.length>0)||_20.args.modal);if(dojo.isString(_21)&&_21.length>0){if(_23){Spring.remoting.renderURLToModalDialog(_21,_20);return _1f;}else{if(_21.indexOf("/")>=0){window.location=window.location.protocol+"//"+window.location.host+_21;}else{var _24=window.location.protocol+"//"+window.location.host+window.location.pathname;var _25=_24.lastIndexOf("/");_24=_24.substr(0,_25+1)+_21;if(_24==window.location){Spring.remoting.getResource(_24,_20.args.content,false);}else{window.location=_24;}}return _1f;}}var _26="(?:<script(.|[\n|\r])*?>)((\n|\r|.)*?)(?:</script>)";var _27=[];var _28=new RegExp(_26,"img");var _29=new RegExp(_26,"im");var _2a=_1f.match(_28);if(_2a!=null){for(var i=0;i<_2a.length;i++){var _2c=(_2a[i].match(_29)||["","",""])[2];_2c=_2c.replace(/<!--/mg,"").replace(/\/\/-->/mg,"").replace(/<!\[CDATA\[(\/\/>)*/mg,"").replace(/(<!)*\]\]>/mg,"");_27.push(_2c);}}_1f=_1f.replace(_28,"");var _2d=dojo.doc.createElement("span");_2d.id="ajaxResponse";_2d.style.visibility="hidden";document.body.appendChild(_2d);_2d.innerHTML=_1f;var _2e=new dojo.NodeList(_2d);var _2f=_2e.query("#ajaxResponse > *").orphan();_2e.orphan();if(_23){Spring.remoting.renderNodeListToModalDialog(_2f);}else{_2f.forEach(function(_30){if(_30.id!=null&&_30.id!=""){var _31=dojo.byId(_30.id);if(!_31){console.error("An existing DOM elment with id '"+_30.id+"' could not be found for replacement.");}else{_31.parentNode.replaceChild(_30,_31);}}});}dojo.forEach(_27,function(_32){dojo.eval(_32);});return _1f;},handleError:function(_33,_34){dojo.require("dijit.Dialog");console.error("HTTP status code: ",_34.xhr.status);if(Spring.debug&&_34.xhr.status!=200){var _35=new dijit.Dialog({});dojo.connect(_35,"hide",_35,function(){this.destroyRecursive(false);});_35.domNode.style.width="80%";_35.domNode.style.height="80%";_35.domNode.style.textAlign="left";_35.setContent(_34.xhr.responseText);_35.show();}return _33;},renderURLToModalDialog:function(url,_37){url=url+"&"+dojo.objectToQuery(_37.args.content);Spring.remoting.getResource(url,{},true);},renderNodeListToModalDialog:function(_38){dojo.require("dijit.Dialog");var _39=new dijit.Dialog({});_39.setContent(_38);dojo.connect(_39,"hide",_39,function(){this.destroyRecursive(false);});_39.show();}});dojo.declare("Spring.CommandLinkDecoration",[Spring.AbstractCommandLinkDecoration,Spring.DefaultEquals],{constructor:function(_3a){dojo.mixin(this,_3a);},apply:function(){var _3b=dojo.byId(this.elementId);if(!dojo.hasClass(_3b,"progressiveLink")){var _3c=new dojo.NodeList(_3b);_3c.addContent(this.linkHtml,"after").orphan("*");_3b=dojo.byId(this.elementId);}_3b.submitFormFromLink=this.submitFormFromLink;return this;},submitFormFromLink:function(_3d,_3e,_3f){var _40=[];var _41=dojo.byId(_3d);var _42=document.createElement("input");_42.name=_3e;_42.value="submitted";_40.push(_42);dojo.forEach(_3f,function(_43){var _44=document.createElement("input");_44.name=_43.name;_44.value=_43.value;_40.push(_44);});dojo.forEach(_40,function(_45){dojo.addClass(_45,"SpringLinkInput");dojo.place(_45,_41,"last");});if((_41.onsubmit?!_41.onsubmit():false)||!_41.submit()){dojo.forEach(_40,function(_46){_41.removeChild(_46);});}}});dojo.addOnLoad(Spring.initialize);
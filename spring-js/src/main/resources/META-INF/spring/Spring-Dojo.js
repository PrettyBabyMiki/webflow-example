/*
 * Copyright 2004-2008 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
dojo.declare("Spring.ElementDecoration",Spring.AbstractElementDecoration,{constructor:function(_1){this.copyFields=new Array("name","value","type","checked","selected","readOnly","disabled","alt","maxLength");dojo.mixin(this,_1);if(this.widgetModule==""){this.widgetModule=this.widgetType;}},apply:function(){if(dijit.byId(this.elementId)){dijit.byId(this.elementId).destroyRecursive(false);}var _2=dojo.byId(this.elementId);for(var _3 in this.copyFields){_3=this.copyFields[_3];if(!this.widgetAttrs[_3]&&_2[_3]&&(typeof _2[_3]!="number"||(typeof _2[_3]=="number"&&_2[_3]>=0))){this.widgetAttrs[_3]=_2[_3];}}dojo.require(this.widgetModule);var _4=dojo.eval(this.widgetType);this.widget=new _4(this.widgetAttrs,_2);this.widget.startup();return this;},validate:function(){if(!this.widget.isValid){return true;}var _5=this.widget.isValid(false);if(!_5){this.widget.state="Error";this.widget._setStateClass();}return _5;}});dojo.declare("Spring.ValidateAllDecoration",Spring.AbstractValidateAllDecoration,{constructor:function(_6){this.originalHandler=null;this.connection=null;dojo.mixin(this,_6);},apply:function(){var _7=dojo.byId(this.elementId);this.originalHandler=_7[this.event];var _8=this;_7[this.event]=function(_9){_8.handleEvent(_9,_8);};return this;},cleanup:function(){dojo.disconnect(this.connection);},handleEvent:function(_a,_b){if(!Spring.validateAll()){dojo.stopEvent(_a);}else{if(dojo.isFunction(_b.originalHandler)){var _c=_b.originalHandler(_a);if(_c==false){dojo.stopEvent(_a);}}}}});dojo.declare("Spring.AjaxEventDecoration",Spring.AbstractAjaxEventDecoration,{constructor:function(_d){this.connection=null;dojo.mixin(this,_d);},apply:function(){this.connection=dojo.connect(dojo.byId(this.elementId),this.event,this,"submit");return this;},cleanup:function(){dojo.disconnect(this.connection);},submit:function(_e){if(this.sourceId==""){this.sourceId=this.elementId;}if(this.formId==""){Spring.remoting.getLinkedResource(this.sourceId,this.params,false);}else{Spring.remoting.submitForm(this.sourceId,this.formId,this.params);}dojo.stopEvent(_e);}});dojo.declare("Spring.RemotingHandler",Spring.AbstractRemotingHandler,{constructor:function(){},submitForm:function(_f,_10,_11){var _12=new Object();for(var key in _11){_12[key]=_11[key];}var _14=dojo.byId(_f);if(_14!=null){if(_14.value!=undefined){_12[_f]=_14.value;}else{_12[_f]=_f;}}if(!_12["ajaxSource"]){_12["ajaxSource"]=_f;}dojo.xhrPost({content:_12,form:_10,handleAs:"text",headers:{"Accept":"text/html;type=ajax"},load:this.handleResponse,error:this.handleError});},getLinkedResource:function(_15,_16,_17){this.getResource(dojo.byId(_15).href,_16,_17);},getResource:function(_18,_19,_1a){dojo.xhrGet({url:_18,content:_19,handleAs:"text",headers:{"Accept":"text/html;type=ajax"},load:this.handleResponse,error:this.handleError,modal:_1a});},handleResponse:function(_1b,_1c){var _1d=_1c.xhr.getResponseHeader("Spring-Redirect-URL");var _1e=_1c.xhr.getResponseHeader("Spring-Modal-View");var _1f=((dojo.isString(_1e)&&_1e.length>0)||_1c.args.modal);if(dojo.isString(_1d)&&_1d.length>0){if(_1f){Spring.remoting.renderURLToModalDialog(_1d,_1c);return _1b;}else{window.location=window.location.protocol+"//"+window.location.host+_1d;return _1b;}}var _20="(?:<script.*?>)((\n|\r|.)*?)(?:</script>)";var _21=[];var _22=new RegExp(_20,"img");var _23=new RegExp(_20,"im");var _24=_1b.match(_22);if(_24!=null){for(var i=0;i<_24.length;i++){var _26=(_24[i].match(_23)||["",""])[1];_26=_26.replace(/<!--/mg,"").replace(/\/\/-->/mg,"");_21.push(_26);}}_1b=_1b.replace(_22,"");var _27=dojo.doc.createElement("div");_27.id="ajaxResponse";_27.style.visibility="hidden";document.body.appendChild(_27);var _28=new dojo.NodeList(_27);var _29=_28.addContent(_1b,"first").query("#ajaxResponse > *").orphan();_28.orphan();if(_1f){Spring.remoting.renderNodeListToModalDialog(_29);}else{_29.forEach(function(_2a){if(_2a.id!=null&&_2a.id!=""){var _2b=dojo.byId(_2a.id);_2b.parentNode.replaceChild(_2a,_2b);}});}dojo.forEach(_21,function(_2c){dojo.eval(_2c);});return _1b;},handleError:function(_2d,_2e){console.error("HTTP status code: ",_2e.xhr.status);return _2d;},renderURLToModalDialog:function(url,_30){url=url+"&"+dojo.objectToQuery(_30.args.content);Spring.remoting.getResource(url,{},true);},renderNodeListToModalDialog:function(_31){dojo.require("dijit.Dialog");var _32=new dijit.Dialog({});_32.setContent(_31);dojo.connect(_32,"hide",_32,function(){this.destroyRecursive(false);});_32.show();}});dojo.declare("Spring.CommandLinkDecoration",Spring.AbstractCommandLinkDecoration,{constructor:function(_33){dojo.mixin(this,_33);},apply:function(){var _34=dojo.byId(this.elementId);if(!dojo.hasClass(_34,"progressiveLink")){var _35=new dojo.NodeList(_34);_35.addContent(this.linkHtml,"after").orphan("*");_34=dojo.byId(this.elementId);}_34.submitFormFromLink=this.submitFormFromLink;return this;},submitFormFromLink:function(_36,_37,_38){var _39=[];var _3a=dojo.byId(_36);var _3b=document.createElement("input");_3b.name=_37;_3b.value="submitted";_39.push(_3b);dojo.forEach(_38,function(_3c){var _3d=document.createElement("input");_3d.name=_3c.name;_3d.value=_3c.value;_39.push(_3d);});dojo.forEach(_39,function(_3e){dojo.addClass(_3e,"SpringLinkInput");dojo.place(_3e,_3a,"last");});if((_3a.onsubmit?!_3a.onsubmit():false)||!_3a.submit()){dojo.forEach(_39,function(_3f){_3a.removeChild(_3f);});}}});dojo.addOnLoad(Spring.initialize);
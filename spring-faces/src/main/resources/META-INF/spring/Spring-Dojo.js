/*
	Copyright (c) 2004-2008, The Dojo Foundation
	All Rights Reserved.

	Licensed under the Academic Free License version 2.1 or above OR the
	modified BSD license. For more information on Dojo licensing, see:

		http://dojotoolkit.org/book/dojo-book-0-9/introduction/licensing
*/


Spring.DojoValidatingFieldAdvisor=function(_1){dojo.mixin(this,_1);};Spring.DojoValidatingFieldAdvisor.prototype={targetElId:"",decoratorType:"",decorator:null,decoratorAttrs:"",apply:function(){if(dijit.byId(this.targetElId)){dijit.byId(this.targetElId).destroyRecursive(false);}this.decorator=eval("new "+this.decoratorType+"("+this.decoratorAttrs+", dojo.byId('"+this.targetElId+"'));");this.decorator.startup();return this;},validate:function(){var _2=this.decorator.isValid(false);if(!_2){this.decorator.state="Error";this.decorator._setStateClass();}return _2;}};Spring.ValidatingFieldAdvisor=Spring.DojoValidatingFieldAdvisor;Spring.DojoRemoteEventAdvisor=function(_3){dojo.mixin(this,_3);};Spring.DojoRemoteEventAdvisor.prototype={event:"",targetId:"",sourceId:"",formId:"",processIds:"",renderIds:"",params:[],connection:null,apply:function(){this.connection=dojo.connect(dojo.byId(this.targetId),this.event,this,"submit");return this;},cleanup:function(){dojo.disconnect(this.connection);},submit:function(){Spring.RemotingHandler.submitForm(this.sourceId,this.formId,this.processIds,this.renderIds,this.params);}};Spring.RemoteEventAdvisor=Spring.DojoRemoteEventAdvisor;Spring.DojoValidateAllAdvisor=function(_4){dojo.mixin(this,_4);};Spring.DojoValidateAllAdvisor.prototype={event:"",targetId:"",originalHandler:null,connection:null,apply:function(){var _5=dojo.byId(this.targetId);this.originalHandler=_5[this.event];var _6=this;_5[this.event]=function(_7){_6.handleEvent(_7,_6);};return this;},cleanup:function(){dojo.disconnect(this.connection);},handleEvent:function(_8,_9){if(!Spring.validateAll()){dojo.stopEvent(_8);}else{var _a=_9.originalHandler(_8);if(_a==false){dojo.stopEvent(_8);}}}};Spring.ValidateAllAdvisor=Spring.DojoValidateAllAdvisor;Spring.DojoRemotingHandler=function(){};Spring.DojoRemotingHandler.prototype={submitForm:function(_b,_c,_d,_e,_f){var _10=new Object();var _11=dojo.byId(_b);_10["processIds"]=_d;_10["renderIds"]=_e;if(_11!=null){if(_11.value){_10[_b]=_11.value;}else{_10[_b]=_b;}}dojo.forEach(_f,function(_12){_10[_12.name]=_12.value;});_10["ajaxSource"]=_b;dojo.xhrPost({content:_10,form:_c,handleAs:"text",headers:{"Accept":"text/html;type=ajax"},load:this.handleResponse,error:this.handleError});},getLinkedResource:function(_13,_14){this.getResource(dojo.byId(_13).href,_14);},getResource:function(_15,_16){dojo.xhrGet({url:_15,handleAs:"text",load:this.handleResponse,error:this.handleError,modal:_16});},handleResponse:function(_17,_18){var _19=_18.xhr.getResponseHeader("Flow-Redirect-URL");var _1a=_18.xhr.getResponseHeader("Flow-Modal-View");var _1b=((dojo.isString(_1a)&&_1a.length>0)||_18.args.modal);if(dojo.isString(_19)&&_19.length>0){if(_1b){Spring.RemotingHandler.renderURLToModalDialog(_19,_18);return _17;}else{window.location=window.location.protocol+"//"+window.location.host+_19;return _17;}}var _1c="(?:<script.*?>)((\n|\r|.)*?)(?:</script>)";var _1d=[];var _1e=new RegExp(_1c,"img");var _1f=new RegExp(_1c,"im");var _20=_17.match(_1e);if(_20!=null){for(var i=0;i<_20.length;i++){var _22=(_20[i].match(_1f)||["",""])[1];_22=_22.replace(/<!--/mg,"").replace(/\/\/-->/mg,"");_1d.push(_22);}}_17=_17.replace(_1e,"");var _23=dojo.doc.createElement("div");_23.id="ajaxResponse";_23.style.visibility="hidden";document.body.appendChild(_23);var _24=new dojo.NodeList(_23);var _25=_24.addContent(_17,"first").query("#ajaxResponse > *").orphan();_24.orphan();if(_1b){Spring.RemotingHandler.renderNodeListToModalDialog(_25);}else{_25.forEach(function(_26){if(_26.id!=null&&_26.id!=""){var _27=dojo.byId(_26.id);_27.parentNode.replaceChild(_26,_27);}});}dojo.forEach(_1d,function(_28){dojo.eval(_28);});return _17;},handleError:function(_29,_2a){console.error("HTTP status code: ",_2a.xhr.status);return _29;},renderURLToModalDialog:function(url,_2c){url=url+"&"+dojo.objectToQuery(_2c.args.content);Spring.RemotingHandler.getResource(url,true);},renderNodeListToModalDialog:function(_2d){dojo.require("dijit.Dialog");var _2e=new dijit.Dialog({});_2e.setContent(_2d);dojo.connect(_2e,"hide",_2e,function(){this.destroyRecursive(false);});_2e.show();}};Spring.RemotingHandler=new Spring.DojoRemotingHandler();Spring.DojoCommandLinkAdvisor=function(_2f){dojo.mixin(this,_2f);};Spring.DojoCommandLinkAdvisor.prototype={targetElId:"",linkHtml:"",apply:function(){var _30=dojo.byId(this.targetElId);if(!dojo.hasClass(_30,"progressiveLink")){var _31=new dojo.NodeList(_30);_31.addContent(this.linkHtml,"after").orphan("*");_30=dojo.byId(this.targetElId);}_30.submitFormFromLink=this.submitFormFromLink;return this;},submitFormFromLink:function(_32,_33,_34){var _35=[];var _36=dojo.byId(_32);var _37=document.createElement("input");_37.name=_33;_37.value="submitted";_35.push(_37);dojo.forEach(_34,function(_38){var _39=document.createElement("input");_39.name=_38.name;_39.value=_38.value;_35.push(_39);});dojo.forEach(_35,function(_3a){dojo.addClass(_3a,"SpringLinkInput");dojo.place(_3a,_36,"last");});if((_36.onsubmit?!_36.onsubmit():false)||!_36.submit()){dojo.forEach(_35,function(_3b){_36.removeChild(_3b);});}}};Spring.CommandLinkAdvisor=Spring.DojoCommandLinkAdvisor;dojo.addOnLoad(Spring.applyAdvisors);